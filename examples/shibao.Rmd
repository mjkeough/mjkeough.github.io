---
title: "QK Box 6.2"

output: 
  html_notebook:
    theme: flatly
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Shibao et al. (2004) studied whether the density of aphids in a colony affected the proportion of soldiers in that colony. They collected galls formed by the aphid *Tuberaphis styraci* from host trees in Japan, and recorded several characteristics of the galls (diameter, height, inner surface area, number of holes) and of the aphids using that gall (number of aphids, proportion of soldier individuals, and aphid density -- no. aphids/surface area). The variables of interest here are the % soldiers and the aphid density (aphids/mm^2^).

![Two types of 2nd instar nymphs. Left, soldier. right, normal nymph. Soldiers are easily recognized by sclerotized cuticle and greenish color, in contrast to soft cuticle and yellowish color of normal 2nd instar nymphs.](../media/Styracis%20not%20for%20final.png){width="500"}

**Needs image here: placeholder image from Shibao et al.**

Link to [paper](doi:%2010.1098/rsbl.2003.0089)

Shibao, H., Kutsukake, M. & Fukatsu, T. (2004). Density triggers soldier production in a social aphid. *Proc Biol Sci*, 271 Suppl 3, S71-4. There are videos of these aphids, linked to Shibao et al. (2022): *Zoology letters* . The videos are in the supplementary material [here](https://doi. org/10.1186/s40851-021-00184-w).

### Preliminaries

First, load the required packages (car, lm.beta, Rmisc) +ggplot2

```{r include=FALSE, results='hide'}
source("../R/libraries.R")   #This is the common library
library(lm.beta)
```

Import shibao data file (shibao.csv)

```{r}
shibao <- read.csv("../data/shibao.csv")
head(shibao,10)
```

### Look at diagnostics

Do initial scatterplot, then we need to fit the model to generate residuals, measures of influence. You'll see here that the linear model is quite straightforward. It is equivalent to the models we describe in the text:

```{r echo=FALSE, results='asis'}
shibao.lm <- lm(soldiers~aphiddens, data=shibao)
equatiomatic::extract_eq(shibao.lm)
```

```{r }
scatterplot (soldiers~aphiddens, data=shibao)
shibao.lm <- lm(soldiers~aphiddens, data=shibao)
plot(shibao.lm)
# influence.measures(shibao.lm)
augment(shibao.lm,data=shibao)
```

### Examine model output

We're comfortable with the diagnostics, so we can now assess the parameters and their confidence intervals:

```{r echo=FALSE, results='asis'}
equatiomatic::extract_eq(shibao.lm, use_coefs = TRUE)
```

```{r }
tidy(shibao.lm, conf.int = TRUE)
glance(shibao.lm)
anova(shibao.lm)
```

Get standardized coefficients

```{r }
lm.beta(shibao.lm)
```
